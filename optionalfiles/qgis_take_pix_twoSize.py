print("hello script")
from qgis.PyQt.QtCore import QRectF
from qgis.core import (
    QgsProject, QgsVectorLayer, QgsFeature, QgsGeometry, QgsPointXY,
    QgsMarkerSymbol, QgsPalLayerSettings, QgsTextFormat, QgsTextBufferSettings,
    QgsVectorLayerSimpleLabeling, QgsLayerTreeLayer
)
from PyQt5.QtGui import QFont
#import more libraries
import math, re
import numpy as np

print("setting CRS")
# --- set project CRS to WGS 84 (lon/lat in degrees) ---
QgsProject.instance().setCrs(QgsCoordinateReferenceSystem("EPSG:4326"))

print("create simple layout")
# --- create a simple layout with one big map and a small label ---
project = QgsProject.instance()
layout = QgsPrintLayout(project)
layout.initializeDefaults()
layout.setName("centres_layout")

map_item = QgsLayoutItemMap(layout)
map_item.setFrameEnabled(True)
map_item.attemptMove(QgsLayoutPoint(20, 20, QgsUnitTypes.LayoutMillimeters))
map_item.attemptResize(QgsLayoutSize(257, 170, QgsUnitTypes.LayoutMillimeters))  # larger map area
#uncomment this if you uncomment the optional section above that initiates the vlyr variable
#if vlyr.isValid():
 #   map_item.setExtent(vlyr.extent())  # initial extent just so we see something
layout.addLayoutItem(map_item)

label = QgsLayoutItemLabel(layout)
layout.addLayoutItem(label)
label.attemptMove(QgsLayoutPoint(20, 5, QgsUnitTypes.LayoutMillimeters))

# --- helper to make an extent centred on (lon, lat) with a buffer in degrees ---
def rect_around(lon, lat, half_w_deg, half_h_deg=None):
    if half_h_deg is None:
        half_h_deg = half_w_deg
    return QgsRectangle(lon - half_w_deg, lat - half_h_deg, lon + half_w_deg, lat + half_h_deg)

print("store test latlongs")
 
listofdicstocsv = [{'lat': np.float64(50.844441271809465), 'long': np.float64(-0.2985307978506628), 'officialname': 'Adur District Council'}, {'lat': np.float64(54.71108952940033), 'long': np.float64(-3.2472347297148736), 'officialname': 'Allerdale Borough Council'}, {'lat': np.float64(53.02923578798895), 'long': np.float64(-1.4666587371164486), 'officialname': 'Amber Valley Borough Council'}, {'lat': np.float64(50.84087482329936), 'long': np.float64(-0.5681884889528159), 'officialname': 'Arun District Council'}, {'lat': np.float64(51.12529509104035), 'long': np.float64(0.8112981989241088), 'officialname': 'Ashford Borough Council'}, {'lat': np.float64(53.09225848020578), 'long': np.float64(-1.2591513420286131), 'officialname': 'Ashfield District Council'}, {'lat': np.float64(52.05062705050395), 'long': np.float64(0.9153154171142276), 'officialname': 'Babergh District Council'}, {'lat': np.float64(53.33277073113091), 'long': np.float64(-0.9589166216011292), 'officialname': 'Bassetlaw District Council'}, {'lat': np.float64(51.59013206565409), 'long': np.float64(0.4662938386691312), 'officialname': 'Basildon Borough Council'}, {'lat': np.float64(51.27345898373285), 'long': np.float64(-1.2009435842572471), 'officialname': 'Basingstoke and Deane Borough Council'}, {'lat': np.float64(54.126557340666345), 'long': np.float64(-3.2122852054861), 'officialname': 'Barrow-in-Furness Borough Council'}, {'lat': np.float64(51.35598528238205), 'long': np.float64(-2.475256294617867), 'officialname': 'Bath and North East Somerset Council'}, {'lat': np.float64(53.69261245008202), 'long': np.float64(-2.4675476946208126), 'officialname': 'Blackburn with Darwen Borough Council'}, {'lat': np.float64(52.18918053057245), 'long': np.float64(-0.4770824350213), 'officialname': 'Bedford Borough Council'}, {'lat': np.float64(51.54397116248155), 'long': np.float64(0.1331640246336178), 'officialname': 'London Borough of Barking and Dagenham'}, {'lat': np.float64(51.55854916343554), 'long': np.float64(-0.2678095362801607), 'officialname': 'London Borough of Brent'}, {'lat': np.float64(51.46088630809562), 'long': np.float64(0.1423430949338968), 'officialname': 'London Borough of Bexley'}, {'lat': np.float64(52.48854726877568), 'long': np.float64(-1.874802373006662), 'officialname': 'Birmingham City Council'}, {'lat': np.float64(52.571507634482245), 'long': np.float64(-1.2219618985461445), 'officialname': 'Blaby District Council'}, {'lat': np.float64(51.616019902950086), 'long': np.float64(-0.2100095486996198), 'officialname': 'London Borough of Barnet'}, {'lat': np.float64(50.84348509595687), 'long': np.float64(-0.1331354533735592), 'officialname': 'Brighton and Hove City Council'}, {'lat': np.float64(53.535870544281714), 'long': np.float64(-1.5325745833475837), 'officialname': 'Barnsley Metropolitan Borough Council'}, {'lat': np.float64(53.57863238912571), 'long': np.float64(-2.4669702024726585), 'officialname': 'Bolton Metropolitan Borough Council'}, {'lat': np.float64(53.215626935522), 'long': np.float64(-1.2773246815469628), 'officialname': 'Bolsover District Council'}, {'lat': np.float64(52.97415774295703), 'long': np.float64(-0.0223468410857168), 'officialname': 'Boston Borough Council'}, {'lat': np.float64(50.74701827327496), 'long': np.float64(-1.8832767544275928), 'officialname': 'Bournemouth, Christchurch and Poole Council'}, {'lat': np.float64(53.817662831154095), 'long': np.float64(-3.035526339791786), 'officialname': 'Blackpool Borough Council'}, {'lat': np.float64(51.94182898789511), 'long': np.float64(0.5899319151089268), 'officialname': 'Braintree District Council'}, {'lat': np.float64(51.40811249783455), 'long': np.float64(-0.7397376225054983), 'officialname': 'Bracknell Forest Council'}, {'lat': np.float64(53.844670463422645), 'long': np.float64(-1.8546713066320164), 'officialname': 'City of Bradford Metropolitan District Council'}, {'lat': np.float64(52.58792949857004), 'long': np.float64(0.8372758295704289), 'officialname': 'Breckland District Council'}, {'lat': np.float64(52.36175127188989), 'long': np.float64(-2.0160150230400915), 'officialname': 'Bromsgrove District Council'}, {'lat': np.float64(52.70119535223855), 'long': np.float64(1.310617336242662), 'officialname': 'Broadland District Council'}, {'lat': np.float64(52.976421123234864), 'long': np.float64(-1.262094876957465), 'officialname': 'Broxtowe Borough Council'}, {'lat': np.float64(51.63863512910911), 'long': np.float64(0.3107597898290793), 'officialname': 'Brentwood Borough Council'}, {'lat': np.float64(51.72511088131843), 'long': np.float64(-0.0473752772279139), 'officialname': 'Broxbourne Borough Council'}, {'lat': np.float64(51.37198136539254), 'long': np.float64(0.0515336301011905), 'officialname': 'London Borough of Bromley'}, {'lat': np.float64(51.45274453311869), 'long': np.float64(-2.770838705597792), 'officialname': 'Bristol City Council'}, {'lat': np.float64(51.78496412170722), 'long': np.float64(-0.8115708416412193), 'officialname': 'Buckinghamshire Council'}, {'lat': np.float64(53.77893551349885), 'long': np.float64(-2.221945291812633), 'officialname': 'Burnley Borough Council'}, {'lat': np.float64(53.58783918019242), 'long': np.float64(-2.3125533829090674), 'officialname': 'Bury Metropolitan Borough Council'}, {'lat': np.float64(52.1993686500059), 'long': np.float64(0.1329234089619653), 'officialname': 'Cambridge City Council'}, {'lat': np.float64(52.33042455105452), 'long': np.float64(0.0698969059309227), 'officialname': 'Cambridgeshire County Council'}, {'lat': np.float64(52.71238260917647), 'long': np.float64(-1.980231864126481), 'officialname': 'Cannock Chase District Council'}, {'lat': np.float64(54.97090807108776), 'long': np.float64(-2.80943938058399), 'officialname': 'Carlisle City Council'}, {'lat': np.float64(51.53640846878514), 'long': np.float64(0.5945937763712772), 'officialname': 'Castle Point Borough Council'}, {'lat': np.float64(51.283226972262185), 'long': np.float64(1.1018038741371656), 'officialname': 'Canterbury City Council'}, {'lat': np.float64(54.69862280385885), 'long': np.float64(-3.14326575232159), 'officialname': 'Cumberland Council'}, {'lat': np.float64(52.00662956306432), 'long': np.float64(-0.4362919550907491), 'officialname': 'Central Bedfordshire Council'}, {'lat': np.float64(52.73700682350879), 'long': np.float64(-1.1461358454775714), 'officialname': 'Charnwood Borough Council'}, {'lat': np.float64(53.18027089095206), 'long': np.float64(-2.3499425324278875), 'officialname': 'Cheshire East Council'}, {'lat': np.float64(50.93742239927705), 'long': np.float64(-0.7422637516761059), 'officialname': 'Chichester District Council'}, {'lat': np.float64(51.72542787780269), 'long': np.float64(0.4809159572751528), 'officialname': 'Chelmsford City Council'}, {'lat': np.float64(53.661483218279066), 'long': np.float64(-2.6478813276134514), 'officialname': 'Chorley Borough Council'}, {'lat': np.float64(51.95878327831902), 'long': np.float64(-1.2755951739539153), 'officialname': 'Cherwell District Council'}, {'lat': np.float64(53.25628073222804), 'long': np.float64(-1.401230942639715), 'officialname': 'Chesterfield Borough Council'}, {'lat': np.float64(51.896999473016216), 'long': np.float64(-2.074022323887118), 'officialname': 'Cheltenham Borough Council'}, {'lat': np.float64(53.2001564783003), 'long': np.float64(-2.7358562336423207), 'officialname': 'Cheshire West and Chester Council'}, {'lat': np.float64(53.72117992991813), 'long': np.float64(-1.973412633228741), 'officialname': 'Calderdale Metropolitan Borough Council'}, {'lat': np.float64(54.52162675715457), 'long': np.float64(-3.01965259637251), 'officialname': 'Cumbria County Council'}, {'lat': np.float64(51.54638879998844), 'long': np.float64(-0.1574137310555219), 'officialname': 'London Borough of Camden'}, {'lat': np.float64(51.8725217524317), 'long': np.float64(0.8609023195144947), 'officialname': 'Colchester Borough Council'}, {'lat': np.float64(50.405621088625495), 'long': np.float64(-4.8272121847503335), 'officialname': 'Cornwall Council'}, {'lat': np.float64(54.41387081108845), 'long': np.float64(-3.373123146665906), 'officialname': 'Copeland Borough Council'}, {'lat': np.float64(51.81645164925951), 'long': np.float64(-1.8929521615729048), 'officialname': 'Cotswold District Council'}, {'lat': np.float64(52.41686840256354), 'long': np.float64(-1.5197503069602478), 'officialname': 'Coventry City Council'}, {'lat': np.float64(54.07982705502182), 'long': np.float64(-2.174251040107192), 'officialname': 'Craven District Council'}, {'lat': np.float64(51.12547062504087), 'long': np.float64(-0.1820346228346824), 'officialname': 'Crawley Borough Council'}, {'lat': np.float64(51.35532032252435), 'long': np.float64(-0.0871674481177516), 'officialname': 'London Borough of Croydon'}, {'lat': np.float64(51.77818248395021), 'long': np.float64(-0.5408769698948943), 'officialname': 'Dacorum Borough Council'}, {'lat': np.float64(54.54869912943138), 'long': np.float64(-1.5525869915306274), 'officialname': 'Darlington Borough Council'}, {'lat': np.float64(51.43145291071959), 'long': np.float64(0.2531677770353175), 'officialname': 'Dartford Borough Council'}, {'lat': np.float64(53.08723783838844), 'long': np.float64(-1.5643477517812396), 'officialname': 'Derbyshire County Council'}, {'lat': np.float64(53.12815027934681), 'long': np.float64(-1.6936800671335397), 'officialname': 'Derbyshire Dales District Council'}, {'lat': np.float64(52.91254467825421), 'long': np.float64(-1.4683439126887443), 'officialname': 'Derby City Council'}, {'lat': np.float64(51.435878796258194), 'long': np.float64(-3.171283841800086), 'officialname': 'Devon County Council'}, {'lat': np.float64(53.54430209689559), 'long': np.float64(-1.09577019730934), 'officialname': 'City of Doncaster Council'}, {'lat': np.float64(50.490189362808415), 'long': np.float64(-3.74005580438028), 'officialname': 'Dorset County Council'}, {'lat': np.float64(51.21228077260466), 'long': np.float64(1.2892144190524706), 'officialname': 'Dover District Council'}, {'lat': np.float64(50.80636608389956), 'long': np.float64(-2.333555874724508), 'officialname': 'Dorset Council'}, {'lat': np.float64(52.48285066829759), 'long': np.float64(-2.1087361271763), 'officialname': 'Dudley Metropolitan Borough Council'}, {'lat': np.float64(54.695458247678815), 'long': np.float64(-1.8399127280188767), 'officialname': 'Durham County Council'}, {'lat': np.float64(51.52247098761109), 'long': np.float64(-0.3310288976681463), 'officialname': 'London Borough of Ealing'}, {'lat': np.float64(50.77623053873892), 'long': np.float64(0.2662294460774007), 'officialname': 'Eastbourne Borough Council'}, {'lat': np.float64(50.9330194885229), 'long': np.float64(-1.3272006847774496), 'officialname': 'Eastleigh Borough Council'}, {'lat': np.float64(52.34291759952867), 'long': np.float64(0.2947826976457143), 'officialname': 'East Cambridgeshire District Council'}, {'lat': np.float64(50.76442428243673), 'long': np.float64(-3.2242493835224417), 'officialname': 'East Devon District Council'}, {'lat': np.float64(54.61277864588224), 'long': np.float64(-2.621821122539382), 'officialname': 'Eden District Council'}, {'lat': np.float64(51.07455401161102), 'long': np.float64(-0.9551242078714512), 'officialname': 'East Hampshire District Council'}, {'lat': np.float64(51.86505606526352), 'long': np.float64(-0.0082579319757085), 'officialname': 'East Hertfordshire District Council'}, {'lat': np.float64(53.24935027000408), 'long': np.float64(0.0303338884753055), 'officialname': 'East Lindsey District Council'}, {'lat': np.float64(51.35713226266936), 'long': np.float64(-0.3921725066072539), 'officialname': 'Elmbridge Borough Council'}, {'lat': np.float64(51.65099149816497), 'long': np.float64(-0.0872544660712145), 'officialname': 'London Borough of Enfield'}, {'lat': np.float64(51.70887779850565), 'long': np.float64(0.1486652074912674), 'officialname': 'Epping Forest District Council'}, {'lat': np.float64(51.33916685668999), 'long': np.float64(-0.2614484467789336), 'officialname': 'Epsom and Ewell Borough Council'}, {'lat': np.float64(52.93549006326073), 'long': np.float64(-1.3466958469347676), 'officialname': 'Erewash Borough Council'}, {'lat': np.float64(53.86804360591298), 'long': np.float64(-0.4824573664609238), 'officialname': 'East Riding of Yorkshire Council'}, {'lat': np.float64(52.23701598937819), 'long': np.float64(1.4614552974725363), 'officialname': 'East Suffolk Council'}, {'lat': np.float64(51.63921739963279), 'long': np.float64(0.4067128387376673), 'officialname': 'Essex County Council'}, {'lat': np.float64(52.86326808861827), 'long': np.float64(-1.8121411818867337), 'officialname': 'East Staffordshire Borough Council'}, {'lat': np.float64(50.88954582009565), 'long': np.float64(0.3158223544559115), 'officialname': 'East Sussex County Council'}, {'lat': np.float64(50.721637905854365), 'long': np.float64(-3.5101801960233034), 'officialname': 'Exeter City Council'}, {'lat': np.float64(50.85264425195757), 'long': np.float64(-1.2246651081052675), 'officialname': 'Fareham Borough Council'}, {'lat': np.float64(52.56284099450951), 'long': np.float64(0.0607712970242638), 'officialname': 'Fenland District Council'}, {'lat': np.float64(51.82842259072888), 'long': np.float64(-2.490024602302281), 'officialname': 'Forest of Dean District Council'}, {'lat': np.float64(53.78410265875071), 'long': np.float64(-2.922134571850851), 'officialname': 'Fylde Borough Council'}, {'lat': np.float64(54.93536850385511), 'long': np.float64(-1.68288722444967), 'officialname': 'Gateshead Metropolitan Borough Council'}, {'lat': np.float64(53.0283720364206), 'long': np.float64(-1.1193100379301255), 'officialname': 'Gedling Borough Council'}, {'lat': np.float64(51.50435262657657), 'long': np.float64(-0.1195450736628444), 'officialname': 'Greater London Authority'}, {'lat': np.float64(51.8493723721493), 'long': np.float64(-2.240264625405542), 'officialname': 'Gloucester City Council'}, {'lat': np.float64(51.85240292931533), 'long': np.float64(-0.7477084584810338), 'officialname': 'Gloucestershire County Council'}, {'lat': np.float64(53.50917111051714), 'long': np.float64(-2.2726169267524297), 'officialname': 'Greater Manchester Combined Authority'}, {'lat': np.float64(50.80521366437385), 'long': np.float64(-1.1594623668753503), 'officialname': 'Gosport Borough Council'}, {'lat': np.float64(51.40512703767118), 'long': np.float64(0.3949941706902553), 'officialname': 'Gravesham Borough Council'}, {'lat': np.float64(51.4744274931101), 'long': np.float64(0.0555381610184994), 'officialname': 'Royal Borough of Greenwich'}, {'lat': np.float64(51.247800046905205), 'long': np.float64(-0.5616455425566013), 'officialname': 'Guildford Borough Council'}, {'lat': np.float64(52.64071397218977), 'long': np.float64(1.6613932629944517), 'officialname': 'Great Yarmouth Borough Council'}, {'lat': np.float64(50.83839140330427), 'long': np.float64(-0.9893616983732988), 'officialname': 'Havant Borough Council'}, {'lat': np.float64(54.28677656243506), 'long': np.float64(-1.3190888600396575), 'officialname': 'Hambleton District Council'}, {'lat': np.float64(54.067101203166125), 'long': np.float64(-1.595539316543793), 'officialname': 'Harrogate Borough Council'}, {'lat': np.float64(53.34374912705788), 'long': np.float64(-2.7187968167209267), 'officialname': 'Halton Borough Council'}, {'lat': np.float64(50.98070818930823), 'long': np.float64(-1.0748168163005136), 'officialname': 'Hampshire County Council'}, {'lat': np.float64(52.53930968542712), 'long': np.float64(-1.0081235595032996), 'officialname': 'Harborough District Council'}, {'lat': np.float64(51.76834906508002), 'long': np.float64(0.1085394577927518), 'officialname': 'Harlow District Council'}, {'lat': np.float64(50.86936430105753), 'long': np.float64(0.5704333476891782), 'officialname': 'Hastings Borough Council'}, {'lat': np.float64(51.28481209348983), 'long': np.float64(-0.8974720055823764), 'officialname': 'Hart District Council'}, {'lat': np.float64(51.56310267262673), 'long': np.float64(0.2204264556767529), 'officialname': 'London Borough of Havering'}, {'lat': np.float64(51.5522665818894), 'long': np.float64(-0.0633174916493753), 'officialname': 'London Borough of Hackney'}, {'lat': np.float64(52.10347883030481), 'long': np.float64(-2.744959614405347), 'officialname': 'Herefordshire Council'}, {'lat': np.float64(51.67728467984929), 'long': np.float64(-0.2810966368650268), 'officialname': 'Hertsmere Borough Council'}, {'lat': np.float64(53.372950278578095), 'long': np.float64(-1.8739385921869005), 'officialname': 'High Peak Borough Council'}, {'lat': np.float64(51.54147044642415), 'long': np.float64(-0.4456607943086098), 'officialname': 'London Borough of Hillingdon'}, {'lat': np.float64(52.616482568961686), 'long': np.float64(-1.3910550819741438), 'officialname': 'Hinckley and Bosworth Borough Council'}, {'lat': np.float64(51.4949927649953), 'long': np.float64(-0.2207719071711307), 'officialname': 'London Borough of Hammersmith & Fulham'}, {'lat': np.float64(51.46849560622163), 'long': np.float64(-0.3661443451475518), 'officialname': 'London Borough of Hounslow'}, {'lat': np.float64(50.9937591191289), 'long': np.float64(-0.3663327499301627), 'officialname': 'Horsham District Council'}, {'lat': np.float64(54.66901341559927), 'long': np.float64(-1.2556506582605669), 'officialname': 'Hartlepool Borough Council'}, {'lat': np.float64(51.44056498086039), 'long': np.float64(-0.7155351399374271), 'officialname': 'Hertfordshire County Council'}, {'lat': np.float64(51.59771706028117), 'long': np.float64(-0.3412773418992901), 'officialname': 'London Borough of Harrow'}, {'lat': np.float64(51.59037232946937), 'long': np.float64(-0.1074687635841607), 'officialname': 'London Borough of Haringey'}, {'lat': np.float64(52.37361380138098), 'long': np.float64(-0.220773550634843), 'officialname': 'Huntingdonshire District Council'}, {'lat': np.float64(53.75864733342495), 'long': np.float64(-2.389783220437551), 'officialname': 'Hyndburn Borough Council'}, {'lat': np.float64(49.93693291412038), 'long': np.float64(-6.31716764074166), 'officialname': 'Council of the Isles of Scilly'}, {'lat': np.float64(50.67577165621564), 'long': np.float64(-1.2965662288145057), 'officialname': 'Isle of Wight Council'}, {'lat': np.float64(52.05587722579369), 'long': np.float64(1.1597791053592093), 'officialname': 'Ipswich Borough Council'}, {'lat': np.float64(51.54848221969582), 'long': np.float64(-0.110244246662168), 'officialname': 'London Borough of Islington'}, {'lat': np.float64(51.501205894607146), 'long': np.float64(-0.1922125559815926), 'officialname': 'Royal Borough of Kensington and Chelsea'}, {'lat': np.float64(51.51540296403236), 'long': np.float64(0.0943925694508491), 'officialname': 'Kent County Council'}, {'lat': np.float64(53.75991316350947), 'long': np.float64(-0.3353759470650819), 'officialname': 'Hull City Council'}, {'lat': np.float64(52.72666055953495), 'long': np.float64(0.4704627975480463), 'officialname': 'Borough Council of Kings Lynn and West Norfolk'}, {'lat': np.float64(53.62735655576655), 'long': np.float64(-1.7633073129732295), 'officialname': 'Kirklees Council'}, {'lat': np.float64(51.3878908166727), 'long': np.float64(-0.2869109309220782), 'officialname': 'Royal Borough of Kingston upon Thames'}, {'lat': np.float64(53.42510056509252), 'long': np.float64(-2.8340373463358604), 'officialname': 'Knowsley Metropolitan Borough Council'}, {'lat': np.float64(54.06899091108889), 'long': np.float64(-2.7147441247307293), 'officialname': 'Lancaster City Council'}, {'lat': np.float64(52.50459775641204), 'long': np.float64(-0.8087773536671569), 'officialname': 'Lancashire County Council'}, {'lat': np.float64(51.45383264156997), 'long': np.float64(-0.1183185700612121), 'officialname': 'London Borough of Lambeth'}, {'lat': np.float64(52.63791436295297), 'long': np.float64(-1.1284852021980178), 'officialname': 'Leicester City Council'}, {'lat': np.float64(53.42633200844039), 'long': np.float64(-2.8834732777352614), 'officialname': 'Liverpool City Region'}, {'lat': np.float64(53.82574639873253), 'long': np.float64(-1.5060163670096938), 'officialname': 'Leeds City Council'}, {'lat': np.float64(53.24519682264041), 'long': np.float64(-1.736134740706938), 'officialname': 'Leicestershire County Council'}, {'lat': np.float64(50.88211278481139), 'long': np.float64(0.0050472081215972), 'officialname': 'Lewes District Council'}, {'lat': np.float64(51.44827189612524), 'long': np.float64(-0.0202904747622759), 'officialname': 'London Borough of Lewisham'}, {'lat': np.float64(53.224726596663416), 'long': np.float64(-0.5549528877639138), 'officialname': 'City of Lincoln Council'}, {'lat': np.float64(52.68816933012296), 'long': np.float64(-1.8049153153682351), 'officialname': 'Lichfield District Council'}, {'lat': np.float64(52.99152922053671), 'long': np.float64(-0.4219714605691583), 'officialname': 'Lincolnshire County Council'}, {'lat': np.float64(53.39545214823893), 'long': np.float64(-2.9170076302903047), 'officialname': 'Liverpool City Council'}, {'lat': np.float64(51.51441102660022), 'long': np.float64(-0.0924448357629193), 'officialname': 'City of London Corporation'}, {'lat': np.float64(51.89422510635098), 'long': np.float64(-0.4255902906491061), 'officialname': 'Luton Borough Council'}, {'lat': np.float64(51.23499792568907), 'long': np.float64(0.5805525642337146), 'officialname': 'Maidstone Borough Council'}, {'lat': np.float64(51.70946298483719), 'long': np.float64(0.7837736768980289), 'officialname': 'Maldon District Council'}, {'lat': np.float64(53.451484399071376), 'long': np.float64(-2.232523760278534), 'officialname': 'Manchester City Council'}, {'lat': np.float64(53.17071502840263), 'long': np.float64(-1.1727869590669462), 'officialname': 'Mansfield District Council'}, {'lat': np.float64(52.18275809360506), 'long': np.float64(-2.344665290528057), 'officialname': 'Malvern Hills District Council'}, {'lat': np.float64(54.54247730105055), 'long': np.float64(-1.2224301963881252), 'officialname': 'Middlesbrough Borough Council'}, {'lat': np.float64(50.87626122180575), 'long': np.float64(-3.5564376935398427), 'officialname': 'Mid Devon District Council'}, {'lat': np.float64(51.42568733548925), 'long': np.float64(0.5694971675887868), 'officialname': 'Medway Council'}, {'lat': np.float64(52.7963818963887), 'long': np.float64(-0.8562185505692235), 'officialname': 'Melton Borough Council'}, {'lat': np.float64(51.20291259669983), 'long': np.float64(-2.544655319516301), 'officialname': 'Mendip District Council'}, {'lat': np.float64(52.08380485083678), 'long': np.float64(-0.7335406531338609), 'officialname': 'Milton Keynes Council'}, {'lat': np.float64(51.212265072976855), 'long': np.float64(-0.3251159748446214), 'officialname': 'Mole Valley District Council'}, {'lat': np.float64(51.409949771281255), 'long': np.float64(-0.1972497078847218), 'officialname': 'London Borough of Merton'}, {'lat': np.float64(51.02084271183233), 'long': np.float64(-0.127051760355822), 'officialname': 'Mid Sussex District Council'}, {'lat': np.float64(52.24682143715788), 'long': np.float64(1.092417153250642), 'officialname': 'Mid Suffolk District Council'}, {'lat': np.float64(55.24151150527719), 'long': np.float64(-2.066344577613037), 'officialname': 'Northumberland County Council'}, {'lat': np.float64(51.06978385051636), 'long': np.float64(-3.9145687175347135), 'officialname': 'North Devon District Council'}, {'lat': np.float64(53.12395037675062), 'long': np.float64(-0.919744263646954), 'officialname': 'Newark and Sherwood District Council'}, {'lat': np.float64(52.99312382296081), 'long': np.float64(-2.3188747366715643), 'officialname': 'Newcastle-under-Lyme Borough Council'}, {'lat': np.float64(54.868803977649705), 'long': np.float64(-1.6050762550747883), 'officialname': 'North East Combined Authority'}, {'lat': np.float64(53.225828819048274), 'long': np.float64(-1.4482879259234107), 'officialname': 'North East Derbyshire District Council'}, {'lat': np.float64(53.54396890653521), 'long': np.float64(-0.1334450838832542), 'officialname': 'North East Lincolnshire Council'}, {'lat': np.float64(55.007665855161406), 'long': np.float64(-1.6578151401098318), 'officialname': 'Newcastle City Council'}, {'lat': np.float64(50.858500864443165), 'long': np.float64(-1.6247467480107955), 'officialname': 'New Forest District Council'}, {'lat': np.float64(52.757398742543245), 'long': np.float64(0.9445418332840452), 'officialname': 'Norfolk County Council'}, {'lat': np.float64(52.96058496357692), 'long': np.float64(-1.1765203961802526), 'officialname': 'Nottingham City Council'}, {'lat': np.float64(51.95909310896309), 'long': np.float64(-0.1927026308244736), 'officialname': 'North Hertfordshire District Council'}, {'lat': np.float64(53.08108045011255), 'long': np.float64(-0.4459259511085638), 'officialname': 'North Kesteven District Council'}, {'lat': np.float64(53.59433045478272), 'long': np.float64(-0.5924994160699526), 'officialname': 'North Lincolnshire Council'}, {'lat': np.float64(52.850478719053605), 'long': np.float64(1.169832919933645), 'officialname': 'North Norfolk District Council'}, {'lat': np.float64(52.4254910202681), 'long': np.float64(-0.6260540289278053), 'officialname': 'North Northamptonshire Council'}, {'lat': np.float64(52.63182972149827), 'long': np.float64(1.2828005617621487), 'officialname': 'Norwich City Council'}, {'lat': np.float64(51.38915163648218), 'long': np.float64(-2.80090053012489), 'officialname': 'North Somerset  Council'}, {'lat': np.float64(55.09262845276407), 'long': np.float64(-1.746616471403686), 'officialname': 'North of Tyne Combined Authority'}, {'lat': np.float64(53.237210248136726), 'long': np.float64(-1.0598693750068051), 'officialname': 'Nottinghamshire County Council'}, {'lat': np.float64(55.02804006958644), 'long': np.float64(-1.5174373649112256), 'officialname': 'North Tyneside Council'}, {'lat': np.float64(52.50112854434047), 'long': np.float64(-1.475871450924939), 'officialname': 'Nuneaton and Bedworth Borough Council'}, {'lat': np.float64(52.54747975379731), 'long': np.float64(-1.6280546081110756), 'officialname': 'North Warwickshire Borough Council'}, {'lat': np.float64(52.753117671347546), 'long': np.float64(-1.4051226190041084), 'officialname': 'North West Leicestershire District Council'}, {'lat': np.float64(51.52688638159061), 'long': np.float64(0.037538661213269), 'officialname': 'London Borough of Newham'}, {'lat': np.float64(54.16561062368424), 'long': np.float64(-1.3778378941997595), 'officialname': 'North Yorkshire Council'}, {'lat': np.float64(54.13299077978593), 'long': np.float64(-1.501223461888315), 'officialname': 'North Yorkshire County Council'}, {'lat': np.float64(52.5871366048144), 'long': np.float64(-1.093407297198589), 'officialname': 'Oadby and Wigston Borough Council'}, {'lat': np.float64(53.55188769653417), 'long': np.float64(-2.0506522949759414), 'officialname': 'Oldham Metropolitan Borough Council'}, {'lat': np.float64(52.02547325888754), 'long': np.float64(-1.2509078895337504), 'officialname': 'Oxfordshire County Council'}, {'lat': np.float64(51.75458662912317), 'long': np.float64(-1.2409629446598192), 'officialname': 'Oxford City Council'}, {'lat': np.float64(53.8654942803231), 'long': np.float64(-2.184930376363977), 'officialname': 'Pendle Borough Council'}, {'lat': np.float64(50.39176951409318), 'long': np.float64(-4.119918213858042), 'officialname': 'Plymouth City Council'}, {'lat': np.float64(50.820443144760695), 'long': np.float64(-1.0783733601449068), 'officialname': 'Portsmouth City Council'}, {'lat': np.float64(53.81179567279308), 'long': np.float64(-2.6976517287341424), 'officialname': 'Preston City Council'}, {'lat': np.float64(52.60855827865765), 'long': np.float64(-0.253108698590496), 'officialname': 'Peterborough City Council'}, {'lat': np.float64(54.55361374426194), 'long': np.float64(-1.0216463800188331), 'officialname': 'Redcar and Cleveland Borough Council'}, {'lat': np.float64(53.616552953932896), 'long': np.float64(-2.157867863164438), 'officialname': 'Rochdale Metropolitan Borough Council'}, {'lat': np.float64(51.58565515490228), 'long': np.float64(0.0758624376705418), 'officialname': 'London Borough of Redbridge'}, {'lat': np.float64(51.452978829455255), 'long': np.float64(-0.9838249955738518), 'officialname': 'Reading Borough Council'}, {'lat': np.float64(52.28228577578808), 'long': np.float64(-1.9518603046635183), 'officialname': 'Redditch Borough Council'}, {'lat': np.float64(51.25320046246119), 'long': np.float64(-0.191853700007665), 'officialname': 'Reigate and Banstead Borough Council'}, {'lat': np.float64(53.90722086891195), 'long': np.float64(-2.444757406174562), 'officialname': 'Ribble Valley Borough Council'}, {'lat': np.float64(51.44273435613829), 'long': np.float64(-0.3123788723815544), 'officialname': 'London Borough of Richmond upon Thames'}, {'lat': np.float64(54.36154156116506), 'long': np.float64(-1.934327027879908), 'officialname': 'Richmondshire District Council'}, {'lat': np.float64(51.5913692358925), 'long': np.float64(0.8092313242624706), 'officialname': 'Rochford District Council'}, {'lat': np.float64(50.95167126903685), 'long': np.float64(0.5388853106819421), 'officialname': 'Rother District Council'}, {'lat': np.float64(53.693815650101136), 'long': np.float64(-2.2672994340454737), 'officialname': 'Rossendale Borough Council'}, {'lat': np.float64(53.40861794874484), 'long': np.float64(-1.2861506496818964), 'officialname': 'Rotherham Metropolitan Borough Council'}, {'lat': np.float64(52.38436142746108), 'long': np.float64(-1.3282942441215568), 'officialname': 'Rugby Borough Council'}, {'lat': np.float64(51.27344347116592), 'long': np.float64(-0.7674814485895685), 'officialname': 'Rushmoor Borough Council'}, {'lat': np.float64(51.39378704378514), 'long': np.float64(-0.5413102987601235), 'officialname': 'Runnymede Borough Council'}, {'lat': np.float64(52.90084728346744), 'long': np.float64(-1.0377351216002713), 'officialname': 'Rushcliffe Borough Council'}, {'lat': np.float64(52.66072351540426), 'long': np.float64(-0.6546906156552161), 'officialname': 'Rutland County Council'}, {'lat': np.float64(54.21049237630077), 'long': np.float64(-0.8520074607323913), 'officialname': 'Ryedale District Council'}, {'lat': np.float64(51.77206179611826), 'long': np.float64(-0.3424945557328514), 'officialname': 'St Albans City and District Council'}, {'lat': np.float64(52.51542732389113), 'long': np.float64(-2.0089727073026205), 'officialname': 'Sandwell Metropolitan Borough Council'}, {'lat': np.float64(52.172789667729496), 'long': np.float64(0.0813003887673401), 'officialname': 'South Cambridgeshire District Council'}, {'lat': np.float64(54.36648447856128), 'long': np.float64(-0.6349710863987603), 'officialname': 'Scarborough Borough Council'}, {'lat': np.float64(53.47344959629804), 'long': np.float64(-1.3663137051626304), 'officialname': 'South Yorkshire Mayoral Combined Authority'}, {'lat': np.float64(52.83099328958791), 'long': np.float64(-1.5595452850429503), 'officialname': 'South Derbyshire District Council'}, {'lat': np.float64(51.18447404125414), 'long': np.float64(-2.952857845654034), 'officialname': 'Sedgemoor District Council'}, {'lat': np.float64(53.78705112913956), 'long': np.float64(-1.134680467696615), 'officialname': 'Selby District Council'}, {'lat': np.float64(51.275410311889445), 'long': np.float64(0.1719723190989084), 'officialname': 'Sevenoaks District Council'}, {'lat': np.float64(52.46793689990327), 'long': np.float64(-0.1112163802179236), 'officialname': 'Suffolk County Council'}, {'lat': np.float64(53.565379666137886), 'long': np.float64(-3.015016318883544), 'officialname': 'Sefton Metropolitan Borough Council'}, {'lat': np.float64(51.54685567791893), 'long': np.float64(-2.470548927985032), 'officialname': 'South Gloucestershire Council'}, {'lat': np.float64(50.37401807021486), 'long': np.float64(-3.822949555101277), 'officialname': 'South Hams District Council'}, {'lat': np.float64(51.05388988809265), 'long': np.float64(0.9941241130735337), 'officialname': 'Folkestone and Hythe District Council'}, {'lat': np.float64(53.40441482465943), 'long': np.float64(-1.5503791233657962), 'officialname': 'Sheffield City Council'}, {'lat': np.float64(53.45947263436788), 'long': np.float64(-2.723620581605936), 'officialname': 'St Helens Council'}, {'lat': np.float64(52.79755782143779), 'long': np.float64(-0.0322907936524514), 'officialname': 'South Holland District Council'}, {'lat': np.float64(52.634901436081904), 'long': np.float64(-2.7340529727893923), 'officialname': 'Shropshire Council'}, {'lat': np.float64(52.85429106105492), 'long': np.float64(-0.5178425812889288), 'officialname': 'South Kesteven District Council'}, {'lat': np.float64(53.39396134376089), 'long': np.float64(-2.128108751007109), 'officialname': 'Stockport Metropolitan Borough Council'}, {'lat': np.float64(54.29269551722641), 'long': np.float64(-2.850076833295411), 'officialname': 'South Lakeland District Council'}, {'lat': np.float64(53.48953887899359), 'long': np.float64(-2.370190747760747), 'officialname': 'Salford City Council'}, {'lat': np.float64(51.50839941899477), 'long': np.float64(-0.5862346624400908), 'officialname': 'Slough Borough Council'}, {'lat': np.float64(51.11561060978463), 'long': np.float64(-2.892494846753527), 'officialname': 'Somerset Council'}, {'lat': np.float64(54.88039884797817), 'long': np.float64(-1.45195283374688), 'officialname': 'Sunderland City Council'}, {'lat': np.float64(52.51457322546016), 'long': np.float64(1.2759971896441038), 'officialname': 'South Norfolk District Council'}, {'lat': np.float64(52.41311661030625), 'long': np.float64(-1.72707700885167), 'officialname': 'Solihull Metropolitan Borough Council'}, {'lat': np.float64(51.12529971400356), 'long': np.float64(-2.7357901367778745), 'officialname': 'Somerset County Council'}, {'lat': np.float64(51.5380480893345), 'long': np.float64(0.7285960419883633), 'officialname': 'Southend-on-Sea Borough Council'}, {'lat': np.float64(51.63374964788932), 'long': np.float64(-1.0714082144457044), 'officialname': 'South Oxfordshire District Council'}, {'lat': np.float64(51.424802538057314), 'long': np.float64(-0.4679835386219939), 'officialname': 'Spelthorne Borough Council'}, {'lat': np.float64(53.7281308819374), 'long': np.float64(-2.7101949607258167), 'officialname': 'South Ribble Borough Council'}, {'lat': np.float64(51.34675381230791), 'long': np.float64(-0.5324429701602681), 'officialname': 'Surrey County Council'}, {'lat': np.float64(50.98814960077109), 'long': np.float64(-2.709890341568709), 'officialname': 'South Somerset District Council'}, {'lat': np.float64(52.62539596750256), 'long': np.float64(-2.1768091357354185), 'officialname': 'South Staffordshire Council'}, {'lat': np.float64(52.84815351076732), 'long': np.float64(-2.176496812156425), 'officialname': 'Stafford Borough Council'}, {'lat': np.float64(53.01801915652019), 'long': np.float64(-2.164528346517783), 'officialname': 'Stoke-on-Trent City Council'}, {'lat': np.float64(53.07931489402547), 'long': np.float64(-1.9812540314568643), 'officialname': 'Staffordshire Moorlands District Council'}, {'lat': np.float64(50.916995975130064), 'long': np.float64(-1.3987136954844517), 'officialname': 'Southampton City Council'}, {'lat': np.float64(51.3620855396189), 'long': np.float64(-0.1775664087611929), 'officialname': 'London Borough of Sutton'}, {'lat': np.float64(51.72926513796569), 'long': np.float64(-2.3001477316823817), 'officialname': 'Stroud District Council'}, {'lat': np.float64(52.17878573484992), 'long': np.float64(-1.6228389374606134), 'officialname': 'Stratford-on-Avon District Council'}, {'lat': np.float64(52.74915681209898), 'long': np.float64(-2.0220493344726065), 'officialname': 'Staffordshire County Council'}, {'lat': np.float64(54.56274136506493), 'long': np.float64(-1.3289799551794848), 'officialname': 'Stockton-on-Tees Borough Council'}, {'lat': np.float64(51.90431488961615), 'long': np.float64(-0.1893323351714038), 'officialname': 'Stevenage Borough Council'}, {'lat': np.float64(54.96352937925816), 'long': np.float64(-1.4442525346180826), 'officialname': 'South Tyneside Council'}, {'lat': np.float64(51.34292838653733), 'long': np.float64(-0.6705485787139046), 'officialname': 'Surrey Heath Borough Council'}, {'lat': np.float64(51.57151810657135), 'long': np.float64(-1.7438128296153603), 'officialname': 'Swindon Borough Council'}, {'lat': np.float64(51.47422966724584), 'long': np.float64(-0.0740580631979552), 'officialname': 'London Borough of Southwark'}, {'lat': np.float64(51.34166345933525), 'long': np.float64(0.8132109078565494), 'officialname': 'Swale Borough Council'}, {'lat': np.float64(51.08690620041343), 'long': np.float64(-3.362575880275063), 'officialname': 'Somerset West and Taunton Council'}, {'lat': np.float64(53.4774719308123), 'long': np.float64(-2.0628138408514944), 'officialname': 'Tameside Metropolitan Borough Council'}, {'lat': np.float64(51.22703213566744), 'long': np.float64(-0.043406638879302), 'officialname': 'Tandridge District Council'}, {'lat': np.float64(52.62642824611261), 'long': np.float64(-1.6778453302279788), 'officialname': 'Tamworth Borough Council'}, {'lat': np.float64(50.60630324730937), 'long': np.float64(-3.6567601373806737), 'officialname': 'Teignbridge District Council'}, {'lat': np.float64(51.871311861448746), 'long': np.float64(1.1150187816535675), 'officialname': 'Tendring District Council'}, {'lat': np.float64(51.12843513028244), 'long': np.float64(-1.5106533666804722), 'officialname': 'Test Valley Borough Council'}, {'lat': np.float64(51.94561525069175), 'long': np.float64(-2.087444553424355), 'officialname': 'Tewkesbury Borough Council'}, {'lat': np.float64(52.73019498472236), 'long': np.float64(-2.488795247370711), 'officialname': 'Telford & Wrekin Council'}, {'lat': np.float64(51.35452755402557), 'long': np.float64(1.3405526776616787), 'officialname': 'Thanet District Council'}, {'lat': np.float64(51.66096739604641), 'long': np.float64(-0.4605986783132673), 'officialname': 'Three Rivers District Council'}, {'lat': np.float64(51.50598371910701), 'long': np.float64(0.3732046175268171), 'officialname': 'Thurrock Council'}, {'lat': np.float64(50.44061869226964), 'long': np.float64(-3.530209751050475), 'officialname': 'Torbay Council'}, {'lat': np.float64(51.27361808281248), 'long': np.float64(0.3578371539074972), 'officialname': 'Tonbridge and Malling Borough Council'}, {'lat': np.float64(50.88736572271978), 'long': np.float64(-4.250752838311364), 'officialname': 'Torridge District Council'}, {'lat': np.float64(53.41899614581493), 'long': np.float64(-2.355349824146495), 'officialname': 'Trafford Metropolitan Borough Council'}, {'lat': np.float64(51.11439772826333), 'long': np.float64(0.4308246609848656), 'officialname': 'Tunbridge Wells Borough Council'}, {'lat': np.float64(54.5754309499998), 'long': np.float64(-1.2762709791286553), 'officialname': 'Tees Valley Combined Authority'}, {'lat': np.float64(51.51573818572293), 'long': np.float64(-0.0346721858626069), 'officialname': 'London Borough of Tower Hamlets'}, {'lat': np.float64(51.93460029169756), 'long': np.float64(0.2798048205628903), 'officialname': 'Uttlesford District Council'}, {'lat': np.float64(51.634232492682536), 'long': np.float64(-1.441668489615587), 'officialname': 'Vale of White Horse District Council'}, {'lat': np.float64(51.14982918794226), 'long': np.float64(-0.6326661735782123), 'officialname': 'Waverley Borough Council'}, {'lat': np.float64(54.34401050125833), 'long': np.float64(-2.8947277204402977), 'officialname': 'Westmorland and Furness Council'}, {'lat': np.float64(51.81204390359955), 'long': np.float64(-0.9016945807738476), 'officialname': 'Warwickshire County Council'}, {'lat': np.float64(51.66808270756288), 'long': np.float64(-0.4033519877259762), 'officialname': 'Watford Borough Council'}, {'lat': np.float64(52.31000275720905), 'long': np.float64(-1.5846650870745134), 'officialname': 'Warwick District Council'}, {'lat': np.float64(51.44962857579953), 'long': np.float64(-1.3044355561501662), 'officialname': 'West Berkshire Council'}, {'lat': np.float64(50.65609002591485), 'long': np.float64(-4.04621752405215), 'officialname': 'West Devon Borough Council'}, {'lat': np.float64(50.9673719495783), 'long': np.float64(0.1986538965742697), 'officialname': 'Wealden District Council'}, {'lat': np.float64(51.76688937910623), 'long': np.float64(-0.194085120862033), 'officialname': 'Welwyn Hatfield Borough Council'}, {'lat': np.float64(51.59401737791972), 'long': np.float64(-0.0126365549472921), 'officialname': 'London Borough of Waltham Forest'}, {'lat': np.float64(53.52414924879084), 'long': np.float64(-2.5895088338917263), 'officialname': 'Wigan Metropolitan Borough Council'}, {'lat': np.float64(51.29711579862765), 'long': np.float64(-1.944607882084722), 'officialname': 'Wiltshire Council'}, {'lat': np.float64(51.02816492320124), 'long': np.float64(-1.221074260474177), 'officialname': 'Winchester City Council'}, {'lat': np.float64(53.66067508359946), 'long': np.float64(-1.41180773208405), 'officialname': 'Wakefield Metropolitan District Council'}, {'lat': np.float64(53.60954767891912), 'long': np.float64(-2.882442248374857), 'officialname': 'West Lancashire Borough Council'}, {'lat': np.float64(53.39275474553512), 'long': np.float64(-0.4771146577781644), 'officialname': 'West Lindsey District Council'}, {'lat': np.float64(52.59925591878938), 'long': np.float64(-1.9663478518550048), 'officialname': 'Walsall Metropolitan Borough Council'}, {'lat': np.float64(52.589190505434544), 'long': np.float64(-2.1209914536604693), 'officialname': 'City of Wolverhampton Council'}, {'lat': np.float64(51.45196377489889), 'long': np.float64(-0.1861907721502609), 'officialname': 'London Borough of Wandsworth'}, {'lat': np.float64(51.48567208466636), 'long': np.float64(-0.6994783215974161), 'officialname': 'Royal Borough of Windsor and Maidenhead'}, {'lat': np.float64(52.22282021010607), 'long': np.float64(-1.0363450240300478), 'officialname': 'West Northamptonshire Council'}, {'lat': np.float64(52.19669266240832), 'long': np.float64(-2.211324223877148), 'officialname': 'Worcester City Council'}, {'lat': np.float64(51.313878625625634), 'long': np.float64(-0.5607701174785087), 'officialname': 'Woking Borough Council'}, {'lat': np.float64(51.42940595634225), 'long': np.float64(-0.8838421855036014), 'officialname': 'Wokingham Borough Council'}, {'lat': np.float64(52.060683848889184), 'long': np.float64(-1.8712255435907792), 'officialname': 'Worcestershire County Council'}, {'lat': np.float64(50.82920555902215), 'long': np.float64(-0.3958120020555553), 'officialname': 'Worthing Borough Council'}, {'lat': np.float64(51.837569801832274), 'long': np.float64(-1.5069302321893132), 'officialname': 'West Oxfordshire District Council'}, {'lat': np.float64(53.36834283944602), 'long': np.float64(-3.0926764439988625), 'officialname': 'Wirral Borough Council'}, {'lat': np.float64(53.3988088671587), 'long': np.float64(-2.5636258674832293), 'officialname': 'Warrington Borough Council'}, {'lat': np.float64(52.27771279713101), 'long': np.float64(0.6220783109865008), 'officialname': 'West Suffolk Council'}, {'lat': np.float64(51.51344188347725), 'long': np.float64(-0.1604557185260401), 'officialname': 'City of Westminster'}, {'lat': np.float64(50.95812431783775), 'long': np.float64(-0.3972356512777322), 'officialname': 'West Sussex County Council'}, {'lat': np.float64(52.164187305082095), 'long': np.float64(-2.0508165247517955), 'officialname': 'Wychavon District Council'}, {'lat': np.float64(53.73611262764813), 'long': np.float64(-1.7017944284322837), 'officialname': 'West Yorkshire Combined Authority'}, {'lat': np.float64(52.37957653584576), 'long': np.float64(-2.274666946756108), 'officialname': 'Wyre Forest District Council'}, {'lat': np.float64(53.90294826807342), 'long': np.float64(-2.8538780073821868), 'officialname': 'Wyre Borough Council'}, {'lat': np.float64(54.16561062368424), 'long': np.float64(-1.3778378941997595), 'officialname': 'York and North Yorkshire Mayoral Combined Authority'}, {'lat': np.float64(53.95871937684785), 'long': np.float64(-1.0614497156516969), 'officialname': 'City of York Council'}]




# two “zoom” windows to export for each location
zoom_windows = [
    (0.1, 0.07),   # tighter view
    (0.2, 0.14),   # wider view
]

exporter = QgsLayoutExporter(layout)
settings = QgsLayoutExporter.ImageExportSettings()
# settings.dpi = 200


out_prefix = "/Users/paul/Downloads/testqgis"

# --- create a reusable in-memory point layer with a name field for labels ---
#DELETED

#add a slice at the end to generate a test sample, e.g. [10:20]
for rec in listofdicstocsv:
    # extract by key
    lat = float(rec.get('lat', float('nan')))
    lon = float(rec.get('long', float('nan')))
    officialname = rec.get('officialname', 'unknown')

    # skip if coords are missing
    if math.isnan(lat) or math.isnan(lon):
        print(f"skipping '{officialname}': missing lat/long")
        continue

    # make a filesystem-safe version of the official name
    safe_name = re.sub(r'[^A-Za-z0-9._-]+', '_', officialname).strip('_')

#loop through the two zoom sizes
    for half_w, half_h in zoom_windows:
        # set the map extent around the current centre
        map_item.setExtent(rect_around(lon, lat, half_w, half_h))

        # update the label text for context (includes officialname)
        label.setText(f"centre: {officialname} (lon {lon:.4f}, lat {lat:.4f}), zoom level: {half_w}, {half_h}")

        # refresh the map item so the marker/label render correctly
        map_item.refresh()

        # include the zoom in the filename (e.g., _win_0.10x0.07deg)
        zoom_tag = f"_{half_w:.2f}x{half_h:.2f}"
        out_path = f"{out_prefix}{safe_name}{zoom_tag}.png"

        result = exporter.exportToImage(out_path, settings)
        if result != QgsLayoutExporter.Success:
            raise RuntimeError(f"Export failed for {out_path}")
        print("wrote", out_path)

